import{R as U,r,m,B as j,j as e}from"./app-7fbde288.js";import{e as F}from"./qr-scanner.min-ef5300fe.js";import{a as X,I as z,B as I,F as G}from"./useFetch-4eb9462d.js";import"./index-3e87c52a.js";const es=()=>{var q;const u=U.useRef(null),[c,x]=r.useState(null),[$,h]=r.useState(!1),[t,d]=r.useState(null),[y,w]=r.useState(""),[k,R]=r.useState(!1),[P,N]=r.useState(!1);r.useEffect(()=>{if(u.current&&!c){const s=new F(u.current,n=>{C(n)},{highlightScanRegion:!0,highlightCodeOutline:!0});x(s)}return()=>{c&&(c.stop(),c.destroy(),x(null))}},[u.current,c]);const A=()=>{c?(h(!0),R(!0),c.start()):console.error("Scanner is not initialized yet")},M=()=>{h(!0),N(!0)},C=async s=>{if(s!=null&&s.data)try{const n=await m.post("https://events.essenciacompany.com/api/tickets/get",{ticket:s==null?void 0:s.data});d(n.data)}catch(n){j("Error scanning ticket",n)}},_=s=>{s.key==="Enter"&&D()},D=async()=>{if(y){N(!1),h(!1);try{const s=await m.post("https://events.essenciacompany.com/api/tickets/get",{ticket:y});d(s.data),w("")}catch(s){j("Error scanning ticket",s)}finally{setIsProcessing(!1)}}},f=(s,n)=>{const a=parseInt(s==null?void 0:s.qty)??0;if(n=parseInt(n),!(n<a)){s={...s,newQty:n};var o=t.extras.map(l=>l.id===s.id?s:l);d(l=>({...l,extras:[...o]}))}},{data:g,isError:Y,isLoading:H,isSuccess:J,refetch:L}=X(["scanner-extras",t],`https://events.essenciacompany.com/api/event-extras/${t==null?void 0:t.event_id}`),[E,Q]=r.useState(!1),[i,v]=r.useState(null),[b,S]=r.useState(1),K=()=>{var o;if(!E){Q(!0);return}const s={...i,qty:0,newQty:b};var n=!0,a=(o=t==null?void 0:t.extras)==null?void 0:o.map(l=>l.id===s.id?(n=!1,{...l,newQty:s.newQty+((l==null?void 0:l.newQty)??(l==null?void 0:l.qty)??0)}):l);n&&(a=[...a,s]),d(l=>({...l,extras:[...a]})),Q(!1),v(null),S(1)},[O,p]=r.useState(!1),V=async()=>{if(p(!0),(await m.post("https://events.essenciacompany.com/api/update-ticket",{ticket:t},{headers:{"Content-Type":"application/json","X-Secret-Key":"pos_password"}})).status==200&&(d(null),h(!1),j("Ticket updated successfully!!"),c)){c.stop();const n=new F(u.current,a=>{C(a)},{highlightScanRegion:!0,highlightCodeOutline:!0});x(n),n.start()}p(!1)},B=async()=>{var n;p(!0);const s=await m.post("https://events.essenciacompany.com/api/tickets/activate",{ticket:t==null?void 0:t.id},{headers:{"Content-Type":"application/json","X-Secret-Key":"pos_password"}});s.status==200&&(d((n=s==null?void 0:s.data)==null?void 0:n.ticket),j("Ticket activated successfully!!")),p(!1)};return e.jsxs("section",{className:"scanner-page",children:[t?e.jsxs("div",{className:"ticket-info",children:[e.jsx("h3",{children:"Ticket Information"}),e.jsxs("div",{className:"ticket-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Owner:"})," ",t==null?void 0:t.owner.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t==null?void 0:t.owner.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"VAT Number:"})," ",t==null?void 0:t.owner.vatNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",t==null?void 0:t.owner.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Event ID:"})," ",t==null?void 0:t.event_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ticket ID:"})," ",t==null?void 0:t.ticket]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," $",t==null?void 0:t.price]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",(t==null?void 0:t.status)===0?"Not Used":"Used"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dates:"})," ",t==null?void 0:t.dates.join(", ")]}),e.jsx("p",{children:e.jsxs("strong",{children:[(t==null?void 0:t.active)===0&&"Not ","Active",(t==null?void 0:t.active)===0&&e.jsx("span",{className:"btn btn-success ms-3 py-1 px-2",onClick:B,children:"Activate"})]})})]}),t!=null&&t.hasExtras?e.jsxs("div",{className:"extras",children:[e.jsx("h4",{children:"Extras"}),e.jsxs("ul",{children:[t==null?void 0:t.extras.map((s,n)=>{const a=parseInt((s==null?void 0:s.newQty)??(s==null?void 0:s.qty)??0),o=parseFloat((s==null?void 0:s.price)??0).toFixed(2);return e.jsxs("span",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"col-md-3 text-start",children:s==null?void 0:s.name}),e.jsxs("div",{className:"update-quantity d-flex align-items-center justify-content-center col-md-3",children:[e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>f(s,a-1),children:"-"}),e.jsx("input",{type:"number",value:a,onChange:l=>f(s,l.target.value),className:"form-control text-center mx-2 border-0",style:{width:"40px"}}),e.jsx("button",{className:"btn btn-outline-dark btn-sm",onClick:()=>f(s,a+1),children:"+"})]}),e.jsxs("span",{className:"col-md-3 text-end",children:["X ",o,"$ ="]}),e.jsxs("span",{className:"col-md-3 text-end",children:[o*parseInt(s!=null&&s.newQty?(s==null?void 0:s.newQty)-(s==null?void 0:s.qty):0),"$"]})]},n)}),E&&e.jsx("div",{className:"modal-body row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"extraSelect",children:"Select Extra"}),e.jsxs("select",{id:"extraSelect",className:"form-control mt-2",defaultValue:(i==null?void 0:i.display_name)??"Select an extra",children:[e.jsx("option",{onClick:()=>v(null),children:"None"}),(q=g==null?void 0:g.data)==null?void 0:q.map((s,n)=>e.jsx("option",{onClick:()=>v(s),children:s==null?void 0:s.display_name},n))]})]}),i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group mt-3 d-flex flex-column justify-content-center align-items-center",children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity"}),e.jsxs(z,{className:"w-50",children:[e.jsx(I,{variant:"outline-secondary",onClick:()=>S(s=>s-1>0?s-1:s),children:"-"}),e.jsx(G.Control,{"aria-label":"Example text with two button addons",className:"text-center",readOnly:!0,value:b}),e.jsx(I,{variant:"outline-danger",onClick:()=>S(s=>s+1),children:"+"})]})]}),e.jsxs("label",{htmlFor:"price",children:["Price",e.jsx("br",{}),(i==null?void 0:i.price)*b,"$"]})]}):""]})})]})]}):null,e.jsx("span",{className:"d-flex justify-content-center align-items-center mt-2",children:e.jsx("button",{type:"button",class:"btn btn-info text-light w-100 py-1",onClick:K,children:"Add extra"})}),e.jsx("span",{className:"d-flex justify-content-center align-items-center mt-2",children:e.jsx("button",{type:"button",class:"btn btn-success text-light w-100 py-1",onClick:V,children:O?"Processing...":"Save Changes"})})]}):$?"":e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"qr-box flex-column",onClick:A,children:[e.jsx("img",{className:"qr-image",src:"/assets/qr-code.png",alt:"QR Code"}),e.jsx("h3",{children:"start scanning"})]}),e.jsxs("div",{className:"qr-box flex-column",onClick:M,children:[e.jsx("img",{className:"qr-image",src:"/assets/keyboard.svg",alt:"keyboard"}),e.jsx("h3",{children:"Enter manually"})]})]}),!t&&e.jsxs("div",{children:[e.jsx("div",{id:"viewfinder",className:"qr-box",style:k?{}:{display:"none"},children:e.jsx("video",{ref:u,children:"Your browser does not support video playback."})}),e.jsx("div",{id:"manual-input",className:"form-group",style:P?{}:{display:"none"},children:e.jsx("input",{type:"text",name:"manual",className:"form-control",id:"manual",value:y,onChange:s=>w(s.target.value),onKeyDown:_,placeholder:"Enter ticket code manually"})})]})]})};export{es as default};
