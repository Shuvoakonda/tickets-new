import{R as _,r as o,m as g,B as v,j as e}from"./app-6efd6b9b.js";import{e as q}from"./qr-scanner.min-a8df683f.js";import{a as P,I as O,B as E,F as B}from"./useFetch-e14b6291.js";import"./index-798e80ce.js";const k=()=>{var Q;const d=_.useRef(null),[i,p]=o.useState(null);o.useEffect(()=>{if(d.current&&!i){const s=new q(d.current,n=>{S(n)},{highlightScanRegion:!0,highlightCodeOutline:!0});p(s)}return()=>{i&&(i.stop(),i.destroy(),p(null))}},[d.current,i]);const F=()=>{i?(i.start(),w(!0)):console.error("Scanner is not initialized yet")},[b,w]=o.useState(!1),[t,u]=o.useState(null),S=async s=>{if(s!=null&&s.data)try{const n=await g.post("https://events.essenciacompany.com/api/tickets/get",{ticket:s==null?void 0:s.data});u(n.data)}catch(n){v("Error scanning ticket",n)}},m=(s,n)=>{const r=parseInt(s==null?void 0:s.qty)??0;if(n=parseInt(n),!(n<r)){s={...s,newQty:n};var a=t.extras.map(l=>l.id===s.id?s:l);u(l=>({...l,extras:[...a]}))}},{data:j,isError:D,isLoading:U,isSuccess:X,refetch:K}=P(["scanner-extras",t],`https://events.essenciacompany.com/api/event-extras/${t==null?void 0:t.event_id}`),[N,C]=o.useState(!1),[c,x]=o.useState(null),[f,y]=o.useState(1),I=()=>{var a;if(!N){C(!0);return}const s={...c,qty:0,newQty:f};var n=!0,r=(a=t==null?void 0:t.extras)==null?void 0:a.map(l=>l.id===s.id?(n=!1,{...l,newQty:s.newQty+((l==null?void 0:l.newQty)??(l==null?void 0:l.qty)??0)}):l);n&&(r=[...r,s]),u(l=>({...l,extras:[...r]})),C(!1),x(null),y(1)},[$,h]=o.useState(!1),R=async()=>{if(h(!0),(await g.post("https://events.essenciacompany.com/api/update-ticket",{ticket:t},{headers:{"Content-Type":"application/json","X-Secret-Key":"pos_password"}})).status==200&&(u(null),w(!1),v("Ticket updated successfully!!"),i)){i.stop();const n=new q(d.current,r=>{S(r)},{highlightScanRegion:!0,highlightCodeOutline:!0});p(n),n.start()}h(!1)},A=async()=>{var n;h(!0);const s=await g.post("https://events.essenciacompany.com/api/tickets/activate",{ticket:t==null?void 0:t.id},{headers:{"Content-Type":"application/json","X-Secret-Key":"pos_password"}});s.status==200&&(u((n=s==null?void 0:s.data)==null?void 0:n.ticket),v("Ticket activated successfully!!")),h(!1)};return e.jsxs("section",{className:"scanner-page",children:[t?e.jsxs("div",{className:"ticket-info",children:[e.jsx("h3",{children:"Ticket Information"}),e.jsxs("div",{className:"ticket-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Owner:"})," ",t==null?void 0:t.owner.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t==null?void 0:t.owner.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"VAT Number:"})," ",t==null?void 0:t.owner.vatNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",t==null?void 0:t.owner.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Event ID:"})," ",t==null?void 0:t.event_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ticket ID:"})," ",t==null?void 0:t.ticket]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," $",t==null?void 0:t.price]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",(t==null?void 0:t.status)===0?"Not Used":"Used"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dates:"})," ",t==null?void 0:t.dates.join(", ")]}),e.jsx("p",{children:e.jsxs("strong",{children:[(t==null?void 0:t.active)===0&&"Not ","Active",(t==null?void 0:t.active)===0&&e.jsx("span",{className:"btn btn-success ms-3 py-1 px-2",onClick:A,children:"Activate"})]})})]}),t!=null&&t.hasExtras?e.jsxs("div",{className:"extras",children:[e.jsx("h4",{children:"Extras"}),e.jsxs("ul",{children:[t==null?void 0:t.extras.map((s,n)=>{const r=parseInt((s==null?void 0:s.newQty)??(s==null?void 0:s.qty)??0),a=parseFloat((s==null?void 0:s.price)??0).toFixed(2);return e.jsxs("span",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"col-md-3 text-start",children:s==null?void 0:s.name}),e.jsxs("div",{className:"update-quantity d-flex align-items-center justify-content-center col-md-3",children:[e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>m(s,r-1),children:"-"}),e.jsx("input",{type:"number",value:r,onChange:l=>m(s,l.target.value),className:"form-control text-center mx-2 border-0",style:{width:"40px"}}),e.jsx("button",{className:"btn btn-outline-dark btn-sm",onClick:()=>m(s,r+1),children:"+"})]}),e.jsxs("span",{className:"col-md-3 text-end",children:["X ",a,"$ ="]}),e.jsxs("span",{className:"col-md-3 text-end",children:[a*parseInt(s!=null&&s.newQty?(s==null?void 0:s.newQty)-(s==null?void 0:s.qty):0),"$"]})]},n)}),N&&e.jsx("div",{className:"modal-body row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"extraSelect",children:"Select Extra"}),e.jsxs("select",{id:"extraSelect",className:"form-control mt-2",defaultValue:(c==null?void 0:c.display_name)??"Select an extra",children:[e.jsx("option",{onClick:()=>x(null),children:"None"}),(Q=j==null?void 0:j.data)==null?void 0:Q.map((s,n)=>e.jsx("option",{onClick:()=>x(s),children:s==null?void 0:s.display_name},n))]})]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group mt-3 d-flex flex-column justify-content-center align-items-center",children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity"}),e.jsxs(O,{className:"w-50",children:[e.jsx(E,{variant:"outline-secondary",onClick:()=>y(s=>s-1>0?s-1:s),children:"-"}),e.jsx(B.Control,{"aria-label":"Example text with two button addons",className:"text-center",readOnly:!0,value:f}),e.jsx(E,{variant:"outline-danger",onClick:()=>y(s=>s+1),children:"+"})]})]}),e.jsxs("label",{htmlFor:"price",children:["Price",e.jsx("br",{}),(c==null?void 0:c.price)*f,"$"]})]}):""]})})]})]}):null,e.jsx("span",{className:"d-flex justify-content-center align-items-center mt-2",children:e.jsx("button",{type:"button",class:"btn btn-info text-light w-100 py-1",onClick:I,children:"Add extra"})}),e.jsx("span",{className:"d-flex justify-content-center align-items-center mt-2",children:e.jsx("button",{type:"button",class:"btn btn-success text-light w-100 py-1",onClick:R,children:$?"Processing...":"Save Changes"})})]}):b?"":e.jsxs("div",{className:"qr-box flex-column",onClick:F,children:[e.jsx("img",{className:"qr-image",src:"/assets/qr-code.png",alt:"QR Code"}),e.jsx("h3",{children:"Tap to start scanning"})]}),!t&&e.jsx("div",{id:"viewfinder",className:"qr-box",style:b?{}:{display:"none"},children:e.jsx("video",{ref:d,children:"Your browser does not support video playback."})})]})};export{k as default};
