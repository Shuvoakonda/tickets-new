var _=Object.defineProperty;var R=(e,t,s)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var N=(e,t,s)=>(R(e,typeof t!="symbol"?t+"":t,s),s);import{t as T,r as b,v as E,d as $,_ as O,w as S,x as D,y as I,p as z,R as F,u as H,b as W,j as n,z as Q,h as q,i as A,a as j,H as Y}from"./app-96864be1.js";import{Q as B,u as U,P as g,f as V,v as X,a as G}from"./index-2c940bde.js";var w=globalThis&&globalThis.__assign||function(){return w=Object.assign||function(e){for(var t,s=1,o=arguments.length;s<o;s++){t=arguments[s];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},w.apply(this,arguments)},J=globalThis&&globalThis.__rest||function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(s[o[r]]=e[o[r]]);return s},K=T("PulseLoader","0% {transform: scale(1); opacity: 1} 45% {transform: scale(0.1); opacity: 0.7} 80% {transform: scale(1); opacity: 1}","pulse");function Z(e){var t=e.loading,s=t===void 0?!0:t,o=e.color,r=o===void 0?"#000000":o,i=e.speedMultiplier,c=i===void 0?1:i,l=e.cssOverride,f=l===void 0?{}:l,u=e.size,m=u===void 0?15:u,h=e.margin,d=h===void 0?2:h,a=J(e,["loading","color","speedMultiplier","cssOverride","size","margin"]),x=w({display:"inherit"},f),P=function(v){return{backgroundColor:r,width:E(m),height:E(m),margin:E(d),borderRadius:"100%",display:"inline-block",animation:"".concat(K," ").concat(.75/c,"s ").concat(v*.12/c,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return s?b.createElement("span",w({style:x},a),b.createElement("span",{style:P(1)}),b.createElement("span",{style:P(2)}),b.createElement("span",{style:P(3)})):null}var k=function(e){$(t,e);function t(o,r){return e.call(this,o,r)||this}var s=t.prototype;return s.bindMethods=function(){e.prototype.bindMethods.call(this),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)},s.setOptions=function(r,i){e.prototype.setOptions.call(this,O({},r,{behavior:S()}),i)},s.getOptimisticResult=function(r){return r.behavior=S(),e.prototype.getOptimisticResult.call(this,r)},s.fetchNextPage=function(r){var i;return this.fetch({cancelRefetch:(i=r==null?void 0:r.cancelRefetch)!=null?i:!0,throwOnError:r==null?void 0:r.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:r==null?void 0:r.pageParam}}})},s.fetchPreviousPage=function(r){var i;return this.fetch({cancelRefetch:(i=r==null?void 0:r.cancelRefetch)!=null?i:!0,throwOnError:r==null?void 0:r.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:r==null?void 0:r.pageParam}}})},s.createResult=function(r,i){var c,l,f,u,m,h,d=r.state,a=e.prototype.createResult.call(this,r,i);return O({},a,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:D(i,(c=d.data)==null?void 0:c.pages),hasPreviousPage:I(i,(l=d.data)==null?void 0:l.pages),isFetchingNextPage:d.isFetching&&((f=d.fetchMeta)==null||(u=f.fetchMore)==null?void 0:u.direction)==="forward",isFetchingPreviousPage:d.isFetching&&((m=d.fetchMeta)==null||(h=m.fetchMore)==null?void 0:h.direction)==="backward"})},t}(B);function ee(e,t,s){var o=z(e,t,s);return U(o,k)}class M extends b.Component{constructor(t){super(t),this.scrollListener=this.scrollListener.bind(this),this.eventListenerOptions=this.eventListenerOptions.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this)}componentDidMount(){this.pageLoaded=this.props.pageStart,this.options=this.eventListenerOptions(),this.attachScrollListener()}componentDidUpdate(){if(this.props.isReverse&&this.loadMore){const t=this.getParentElement(this.scrollComponent);t.scrollTop=t.scrollHeight-this.beforeScrollHeight+this.beforeScrollTop,this.loadMore=!1}this.attachScrollListener()}componentWillUnmount(){this.detachScrollListener(),this.detachMousewheelListener()}isPassiveSupported(){let t=!1;const s={get passive(){t=!0}};try{document.addEventListener("test",null,s),document.removeEventListener("test",null,s)}catch{}return t}eventListenerOptions(){let t=this.props.useCapture;return this.isPassiveSupported()?t={useCapture:this.props.useCapture,passive:!0}:t={passive:!1},t}setDefaultLoader(t){this.defaultLoader=t}detachMousewheelListener(){let t=window;this.props.useWindow===!1&&(t=this.scrollComponent.parentNode),t.removeEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture)}detachScrollListener(){let t=window;this.props.useWindow===!1&&(t=this.getParentElement(this.scrollComponent)),t.removeEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),t.removeEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture)}getParentElement(t){const s=this.props.getScrollParent&&this.props.getScrollParent();return s??(t&&t.parentNode)}filterProps(t){return t}attachScrollListener(){const t=this.getParentElement(this.scrollComponent);if(!this.props.hasMore||!t)return;let s=window;this.props.useWindow===!1&&(s=t),s.addEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture),s.addEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),s.addEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture),this.props.initialLoad&&this.scrollListener()}mousewheelListener(t){t.deltaY===1&&!this.isPassiveSupported()&&t.preventDefault()}scrollListener(){const t=this.scrollComponent,s=window,o=this.getParentElement(t);let r;if(this.props.useWindow){const i=document.documentElement||document.body.parentNode||document.body,c=s.pageYOffset!==void 0?s.pageYOffset:i.scrollTop;this.props.isReverse?r=c:r=this.calculateOffset(t,c)}else this.props.isReverse?r=o.scrollTop:r=t.scrollHeight-o.scrollTop-o.clientHeight;r<Number(this.props.threshold)&&t&&t.offsetParent!==null&&(this.detachScrollListener(),this.beforeScrollHeight=o.scrollHeight,this.beforeScrollTop=o.scrollTop,typeof this.props.loadMore=="function"&&(this.props.loadMore(this.pageLoaded+=1),this.loadMore=!0))}calculateOffset(t,s){return t?this.calculateTopPosition(t)+(t.offsetHeight-s-window.innerHeight):0}calculateTopPosition(t){return t?t.offsetTop+this.calculateTopPosition(t.offsetParent):0}render(){const t=this.filterProps(this.props),{children:s,element:o,hasMore:r,initialLoad:i,isReverse:c,loader:l,loadMore:f,pageStart:u,ref:m,threshold:h,useCapture:d,useWindow:a,getScrollParent:x,...P}=t;P.ref=L=>{this.scrollComponent=L,m&&m(L)};const v=[s];return r&&(l?c?v.unshift(l):v.push(l):this.defaultLoader&&(c?v.unshift(this.defaultLoader):v.push(this.defaultLoader))),F.createElement(o,P,v)}}N(M,"propTypes",{children:g.node.isRequired,element:g.node,hasMore:g.bool,initialLoad:g.bool,isReverse:g.bool,loader:g.node,loadMore:g.func.isRequired,pageStart:g.number,ref:g.func,getScrollParent:g.func,threshold:g.number,useCapture:g.bool,useWindow:g.bool}),N(M,"defaultProps",{element:"div",hasMore:!1,initialLoad:!0,pageStart:0,ref:null,threshold:250,useWindow:!0,isReverse:!1,useCapture:!1,loader:null,getScrollParent:null});const te=({ticket:e})=>{var l,f,u,m,h;const t=H(),s=d=>{d.stopPropagation(),t(Q(e))},{addItem:o,removeItem:r,inCart:i}=W(),c=i(e==null?void 0:e.id);return n.jsx("div",{className:`ticket-item-container col-lg-2 col-md-3 col-sm-3 col-6 my-hover-effect g-3 ${c?"active":""}`,onClick:()=>o(e),children:n.jsxs("div",{className:"ticket-item-card",children:[c?n.jsx("button",{className:"delete-btn",onClick:()=>{r(e.id)},children:n.jsx("i",{className:"fa fa-times"})}):"",n.jsxs("div",{className:"custom-card",children:[n.jsx("span",{className:"ticket-item-badge",children:V(e!=null&&e.sale_price?e==null?void 0:e.sale_price:e==null?void 0:e.price)}),n.jsxs("div",{className:"card-header position-relative",children:[n.jsx("img",{className:"ticket-item-img",src:X(e==null?void 0:e.event_thumbnail)}),((l=e==null?void 0:e.event)==null?void 0:l.name)&&n.jsx("span",{className:"ticket-item-unit",children:((f=e==null?void 0:e.event)==null?void 0:f.name.length)>15?`${e.event.name.substring(0,15)}...`:(u=e==null?void 0:e.event)==null?void 0:u.name})]}),n.jsxs("div",{className:"card-body ticket-item-body",children:[n.jsx("p",{title:e.name,className:"ticket-item-name",children:(e==null?void 0:e.name.length)>15?`${e.name.substring(0,15)}...`:e.name}),n.jsx("small",{className:"ticket-item-generic",children:((h=(m=e==null?void 0:e.event)==null?void 0:m.organizer)==null?void 0:h.length)>25?`${e.event.organizer.substring(0,25)}...`:e==null?void 0:e.event.organizer}),(e==null?void 0:e.start_date)&&(e==null?void 0:e.end_date)&&n.jsxs("small",{children:["(",G(e.start_date,e.end_date),")"]}),n.jsx("button",{onClick:s,className:"btn btn-primary btn-sm position-absolute rounded-circle ticket-item-info-btn",children:n.jsx("i",{className:"fa fa-info"})})]})]})]})})},se=(e,t,s={},o={})=>{const{prefetch:r,pageSize:i=10,...c}=o,l=q(),f=async({pageParam:p=1})=>(await A.get(`${t}?page=${p}&per_page=5&query=${(s==null?void 0:s.query)??""}&event_id=${(s==null?void 0:s.event_id)??""}&event_date=${(s==null?void 0:s.eventDate)??""}`,{headers:{"Content-Type":"application/json"}})).data,{data:u,isLoading:m,isError:h,isSuccess:d,error:a,hasNextPage:x,fetchNextPage:P,isFetching:v}=ee(e,f,{...c,getNextPageParam:p=>{const y=p==null?void 0:p.current_page,C=p==null?void 0:p.last_page;return y<C?y+1:null}});return b.useEffect(()=>{var p;((p=a==null?void 0:a.response)==null?void 0:p.status)===401&&localStorage.setItem("authData",null)},[h,a]),{data:u,isLoading:m,isError:h,isSuccess:d,hasNextPage:x,isFetching:v,fetchNextPage:P,refetch:p=>{l.invalidateQueries(p||e)},setData:p=>{l.setQueryData(e,y=>p(y))}}};function ae(){var d;const e=j(a=>a.searchQuery.query),t=j(a=>a.filter.event),s=j(a=>a.filter.date),{data:o,isError:r,isLoading:i,isSuccess:c,isFetching:l,hasNextPage:f,fetchNextPage:u,refetch:m}=se(["tickets",e,t,s],"https://events.essenciacompany.com/api/tickets",{query:e,event_id:t==null?void 0:t.id,eventDate:s}),h=b.useCallback(()=>{const a=document.documentElement.scrollTop;a<500&&a===0&&f&&!l&&u()},[u,f,l]);return b.useEffect(()=>(window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}),[h]),n.jsx("div",{className:"overflow-y-scroll overflow-x-none pt-3",children:i?n.jsx("div",{style:{width:"100%",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:n.jsx(Y,{color:"#36d7b7"})}):n.jsx(M,{loadMore:u,hasMore:f,loader:n.jsx("div",{style:{textAlign:"center",paddingTop:"25px"},children:n.jsx(Z,{color:"#36d7b7"})}),useWindow:!1,style:{overflowY:"scroll",overflowX:"hidden",maxHeight:"90vh",padding:"20px 10px"},onScroll:h,children:n.jsx("div",{className:"row g-3",children:r?n.jsx("div",{style:{textAlign:"center",color:"red"},children:"Something went wrong"}):(d=o==null?void 0:o.pages)!=null&&d.length?o.pages.map((a,x)=>n.jsx(b.Fragment,{children:a.data.map((P,v)=>n.jsx(te,{ticket:P},v))},x)):n.jsx("div",{style:{textAlign:"center"},children:"No matching products found."})})})})}export{ae as default};
